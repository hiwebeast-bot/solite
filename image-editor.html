<!DOCTYPE html>
<html lang="en" class="scroll-smooth dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- MODIFIED: Optimized Title -->
    <title>Free Online Image Editor: Crop, Resize, Filter &amp; Watermark | Solite</title>

    <!-- SEO & Social Sharing Meta Tags -->
    <meta name="description" content="A free online image editor to crop, resize, filter, and watermark images in your browser. No uploads required for 100% privacy. Supports PNG, JPG, WebP.">
    <!-- MODIFIED: Expanded Keywords -->
    <meta name="keywords" content="solite, image editor, photo editor, crop image, resize image, add watermark, image filter, webp converter, image compressor, online photo editor, privacy first, free image editor, browser image editor">
    <link rel="canonical" href="https://solite.in/image-editor.html" />
    <!-- MODIFIED: Optimized OG Title -->
    <meta property="og:title" content="Free Online Image Editor: Crop, Resize, Filter &amp; Watermark | Solite">
    <meta property="og:description" content="A free online image editor to crop, resize, filter, and watermark images in your browser. No uploads required for 100% privacy.">
    <meta property="og:site_name" content="Solite">
    <meta property="og:image" content="https://solite.in/assets/solite-image-editor-og.png">
    <meta property="og:url" content="https://solite.in/image-editor.html">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">

    <!-- Vercel Analytics -->
    <script>
        window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments); };
    </script>
    <script src="/_vercel/insights/script.js" defer></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Favicon Set -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#000000">
    
    <!-- Schema.org Markup -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Image Editor | Solite",
      "url": "https://solite.in/image-editor.html",
      "description": "A free, client-side image editor to crop, resize, watermark, apply filters, and convert images instantly. No uploads, 100% private.",
      "applicationCategory": "DesignApplication",
      "featureList": [
        "Adjust image brightness, contrast, and blur",
        "Apply filters (grayscale, sepia, invert)",
        "Resize images with aspect ratio lock",
        "Preset and manual cropping options (square, landscape, portrait, custom shapes)",
        "Add text watermarks (customizable font, size, color, opacity)",
        "Add image watermarks (adjustable size and opacity)",
        "Export images in various formats (PNG, JPEG, WebP, BMP, GIF, TIFF, SVG)",
        "Undo/Redo functionality",
        "Client-side processing for privacy"
      ],
      "operatingSystem": "All",
      "browserRequirements": "Requires a modern web browser with JavaScript enabled.",
      "provider": {
        "@type": "Organization",
        "name": "Solite",
        "url": "https://solite.in"
      },
      "dateModified": "2025-11-06T10:00:00Z",
      "mainEntity": {
        "@type": "HowTo",
        "name": "How to Edit an Image Online",
        "step": [
          { "@type": "HowToStep", "name": "Step 1: Upload Image", "text": "Drag and drop an image file onto the page or click to select one from your device." },
          { "@type": "HowToStep", "name": "Step 2: Edit", "text": "Use the controls in the 'Adjust', 'Crop', and 'Watermark' tabs to modify your image. You can apply filters, resize, crop to specific aspect ratios, or add text and image watermarks." },
          { "@type": "HowToStep", "name": "Step 3: Export", "text": "Go to the 'Export' tab, choose your desired format (PNG, JPEG, WebP, etc.), and click 'Download Image' to save the final result." }
        ]
      }
    },
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://solite.in/index.html"
      },{
        "@type": "ListItem",
        "position": 2,
        "name": "Image Editor"
      }]
    }
    </script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <style>
        #toast { transform: translateY(-150%); transition: transform 0.3s ease-in-out; }
        #toast.show { transform: translateY(2rem); }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 16px; height: 16px; background: #ffffff; cursor: pointer; border-radius: 9999px; margin-top: -6px; }
        input[type=range]::-moz-range-thumb { width: 16px; height: 16px; background: #ffffff; cursor: pointer; border-radius: 9999px; }
        .custom-select { -webkit-appearance: none; -moz-appearance: none; appearance: none; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background-color: #4b5563; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background-color: #6b7280; }
        html { scrollbar-color: #4b5563 #111827; }
        /* Mobile Nav Styles */
        .mobile-nav-btn.active { color: #ffffff; }
        .mobile-nav-btn { color: #9ca3af; }
    </style>
</head>
<body class="bg-black text-gray-200 flex flex-col min-h-screen font-sans">
    
    <header class="p-3 sm:p-4 w-full flex-shrink-0 sticky top-0 bg-white/80 dark:bg-black/80 backdrop-blur-xl z-30 border-b border-gray-200 dark:border-gray-800">
        <div class="flex justify-between items-center">
            <a href="index.html" class="flex flex-col space-y-1 lg:flex-row lg:items-center lg:space-x-3 lg:space-y-0" aria-label="Solite Homepage">
                <div class="flex items-center space-x-3">
                     <svg class="h-6 w-6 lg:h-8 lg:w-8 text-gray-900 dark:text-white flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2L2 7l10 5 10-5L12 2z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 7l10 5 10-5"></path>
                    </svg>
                    <span class="text-base lg:text-xl font-bold text-gray-900 dark:text-white uppercase tracking-wider leading-none">Solite</span>
                </div>
                <span class="h-6 w-px bg-gray-300 dark:bg-gray-700 hidden lg:block"></span>
                <span class="text-lg lg:text-lg font-semibold text-gray-600 dark:text-gray-400 leading-none">Image Editor</span>
            </a>
             <div class="flex items-center space-x-4">
                <a href="index.html#apps" class="bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-gray-700 text-gray-800 dark:text-white font-medium py-2 px-4 rounded-lg transition-colors flex items-center space-x-1.5">
                    <span>Free Tools</span>
                    <svg class="h-4 w-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5-5 5"></path></svg>
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow flex relative min-h-0" style="height: calc(100vh - 72px);">
        <div class="flex-grow w-full lg:w-[80%] p-3 pb-16 lg:pb-3 overflow-y-auto flex flex-col lg:flex-row gap-4 min-h-0">
            
            <div id="preview-pane" class="flex-1 flex flex-col min-h-0">
                <div id="canvas-container" class="flex-1 flex flex-col items-center justify-center bg-gray-900 rounded-xl border-2 border-dashed border-gray-700 p-4 relative overflow-auto">
                    <div id="upload-prompt" class="text-center cursor-pointer p-8">
                        <h1 class="sr-only">Free Online Image Editor</h1>
                        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                        <h3 class="mt-2 text-lg font-medium text-white">Drop an image here or click to upload</h3>
                        <p class="mt-1 text-sm text-gray-400">Supports PNG, JPG, WebP. Your images stay on your device.</p>
                    </div>
                    <canvas id="canvas" class="hidden"></canvas>
                    <input type="file" id="image-upload" class="hidden" accept="image/png, image/jpeg, image/webp">
                    <button id="remove-image-btn" title="Remove Image" class="hidden absolute top-4 right-4 text-gray-300 hover:text-white bg-gray-800/50 hover:bg-gray-700/70 backdrop-blur-sm rounded-lg p-2 leading-none z-10 flex items-center gap-2 text-sm font-medium">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                        <span>Remove</span>
                    </button>
                </div>
            </div>

            <!-- Controls Panel -->
            <div id="controls-panel" class="w-full lg:w-96 flex-shrink-0 bg-gray-900 rounded-xl border border-gray-800 p-1 lg:block flex flex-col overflow-y-auto">
                <div class="flex justify-between items-center p-4">
                    <h3 class="text-lg font-bold text-white">Image Controls</h3>
                    <div class="flex items-center space-x-2">
                        <button id="undo-btn" title="Undo" class="text-gray-400 hover:text-white bg-gray-700 rounded-lg p-2 leading-none disabled:opacity-50 disabled:cursor-not-allowed" disabled><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3" /></svg></button>
                        <button id="redo-btn" title="Redo" class="text-gray-400 hover:text-white bg-gray-700 rounded-md p-2 leading-none" disabled><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15 15l6-6m0 0l-6-6m6 6H9a6 6 0 000 12h3" /></svg></button>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="border-b border-gray-800 px-2 font-sans">
                    <div class="flex -mb-px">
                        <button class="tab text-gray-400 hover:text-gray-200 border-b-2 border-transparent transition-colors flex-1 py-3 px-4 text-center text-sm font-medium" data-tab="adjust">Adjust</button>
                        <button class="tab text-gray-400 hover:text-gray-200 border-b-2 border-transparent transition-colors flex-1 py-3 px-4 text-center text-sm font-medium" data-tab="crop">Crop</button>
                        <button class="tab text-gray-400 hover:text-gray-200 border-b-2 border-transparent transition-colors flex-1 py-3 px-4 text-center text-sm font-medium" data-tab="watermark">Watermark</button>
                        <button class="tab text-gray-400 hover:text-gray-200 border-b-2 border-transparent transition-colors flex-1 py-3 px-4 text-center text-sm font-medium" data-tab="export">Export</button>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="p-4 space-y-5 flex-grow min-h-0 overflow-y-auto">
                    <div id="adjust-tab" class="tab-content space-y-4">
                        <h4 class="font-semibold text-gray-200">Filters & Adjustments</h4>
                        <div class="grid grid-cols-2 gap-2">
                            <button class="filter-btn bg-gray-700 hover:bg-gray-600 py-2 px-4 rounded-lg font-medium" data-filter="grayscale">Grayscale</button>
                            <button class="filter-btn bg-gray-700 hover:bg-gray-600 py-2 px-4 rounded-lg font-medium" data-filter="sepia">Sepia</button>
                            <button class="filter-btn bg-gray-700 hover:bg-gray-600 py-2 px-4 rounded-lg font-medium" data-filter="invert">Invert</button>
                            <button id="reset-btn" class="bg-gray-700 hover:bg-gray-600 py-2 px-4 rounded-lg font-medium">Reset All</button>
                        </div>
                         <div class="space-y-3 pt-2">
                            <!-- MODIFIED: Added value display spans -->
                            <label class="block"><span class="text-sm">Brightness (<span class="value-display">0</span>)</span><input type="range" id="brightness-slider" min="-100" max="100" value="0" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"></label>
                            <label class="block"><span class="text-sm">Contrast (<span class="value-display">0</span>)</span><input type="range" id="contrast-slider" min="-100" max="100" value="0" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"></label>
                            <label class="block"><span class="text-sm">Blur (<span class="value-display">0</span>px)</span><input type="range" id="blur-slider" min="0" max="10" value="0" step="0.1" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"></label>
                        </div>
                    </div>

                    <div id="crop-tab" class="tab-content hidden space-y-4">
                        <div>
                            <h4 class="font-semibold text-gray-200 mb-2">Resize</h4>
                            <div class="space-y-2">
                                <div class="flex items-center gap-2">
                                    <input type="number" id="resize-width" placeholder="Width" aria-label="Resize Width" class="w-full p-2 rounded-lg bg-gray-800 border border-gray-700">
                                    <button id="aspect-lock-btn" title="Toggle Aspect Ratio Lock" aria-label="Toggle Aspect Ratio Lock" class="p-2 bg-white text-black rounded-lg flex-shrink-0">
                                        <svg id="lock-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
                                        <svg id="unlock-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M8 11V7a4 4 0 118 0m-4 8v3m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z" /></svg>
                                    </button>
                                    <input type="number" id="resize-height" placeholder="Height" aria-label="Resize Height" class="w-full p-2 rounded-lg bg-gray-800 border border-gray-700">
                                </div>
                                <button id="apply-resize-btn" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 px-3 rounded-lg">Apply Resize</button>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-200 mb-2">Preset Crop</h4>
                             <div class="grid grid-cols-4 gap-2">
                                <button class="aspect-crop-btn bg-gray-700 hover:bg-gray-600 py-2 rounded-lg text-xs font-medium" data-ratio="1:1">Square</button>
                                <button class="aspect-crop-btn bg-gray-700 hover:bg-gray-600 py-2 rounded-lg text-xs font-medium" data-ratio="16:9">Landscape</button>
                                <button class="aspect-crop-btn bg-gray-700 hover:bg-gray-600 py-2 rounded-lg text-xs font-medium" data-ratio="4:3">Classic</button>
                                <button class="aspect-crop-btn bg-gray-700 hover:bg-gray-600 py-2 rounded-lg text-xs font-medium" data-ratio="4:5">Portrait</button>
                            </div>
                            <div class="grid grid-cols-6 gap-2 mt-2">
                                <button class="shape-crop-btn bg-gray-700 hover:bg-gray-600 p-2 rounded-lg flex justify-center items-center h-12" data-shape="circle" title="Circle Crop"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"></circle></svg></button>
                                <button class="shape-crop-btn bg-gray-700 hover:bg-gray-600 p-2 rounded-lg flex justify-center items-center h-12" data-shape="star" title="Star Crop"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg></button>
                                <button class="shape-crop-btn bg-gray-700 hover:bg-gray-600 p-2 rounded-lg flex justify-center items-center h-12" data-shape="hexagon" title="Hexagon Crop"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polygon points="12 2 20 7 20 17 12 22 4 17 4 7 12 2"></polygon></svg></button>
                                <button class="shape-crop-btn bg-gray-700 hover:bg-gray-600 p-2 rounded-lg flex justify-center items-center h-12" data-shape="blob" title="Blob Crop"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M20.9,13.7C20.4,17.2,17,20,13,20C9,20,5.6,17.2,5.1,13.7C4.6,10.2,7.5,6,12.5,6S21.4,10.2,20.9,13.7Z" transform="rotate(45 12 12)"></path></svg></button>
                                <button class="shape-crop-btn bg-gray-700 hover:bg-gray-600 p-2 rounded-lg flex justify-center items-center h-12" data-shape="heart" title="Heart Crop"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></button>
                                <button class="shape-crop-btn bg-gray-700 hover:bg-gray-600 p-2 rounded-lg flex justify-center items-center h-12" data-shape="triangle" title="Triangle Crop"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polygon points="12 2 22 22 2 22 12 2"></polygon></svg></button>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-200 mb-2">Manual Crop</h4>
                            <p class="text-sm text-gray-400 mb-2">Check to enable, then drag on the image to select an area.</p>
                             <label for="enable-manual-crop" class="w-full flex justify-between items-center text-left py-2 px-4 rounded-lg border-2 border-gray-600 hover:border-gray-500 mb-2 cursor-pointer">
                                <span>Enable Manual Crop</span>
                                <input type="checkbox" id="enable-manual-crop" class="h-4 w-4 rounded bg-gray-700 border-gray-600 text-blue-500 focus:ring-blue-500">
                            </label>
                            <button id="apply-crop-btn" class="w-full bg-white hover:bg-gray-200 text-black font-bold py-3 px-4 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">Apply Crop</button>
                        </div>
                    </div>

                    <div id="watermark-tab" class="tab-content hidden space-y-4">
                        <div class="flex bg-gray-700 rounded-lg p-1 text-gray-300">
                            <button id="text-watermark-btn" class="watermark-type-btn bg-white text-black flex-1 py-1 text-sm rounded-md font-medium">Text</button>
                            <button id="image-watermark-btn" class="watermark-type-btn flex-1 py-1 text-sm rounded-md font-medium text-gray-300">Image</button>
                        </div>

                        <div id="text-watermark-controls" class="space-y-4">
                            <input type="text" id="watermark-text" placeholder="Your watermark text..." class="w-full p-3 rounded-lg bg-gray-700 border-gray-600">
                            <!-- MODIFIED: Added value display spans -->
                            <label class="block"><span class="text-sm">Font Size (<span class="value-display">50</span>px)</span><input type="range" id="watermark-size" min="10" max="200" value="50" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"></label>
                            <label class="block"><span class="text-sm">Opacity (<span class="value-display">0.7</span>)</span><input type="range" id="watermark-opacity" min="0" max="1" value="0.7" step="0.05" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"></label>
                            <div>
                                <span class="text-sm">Color</span>
                                <div id="color-presets" class="grid grid-cols-8 gap-2 mt-1 mb-2"></div>
                                <input type="color" id="watermark-color" value="#ffffff" class="w-full p-1 h-10 bg-gray-700 rounded-lg cursor-pointer">
                            </div>
                        </div>

                        <div id="image-watermark-controls" class="hidden space-y-4">
                            <input type="file" id="watermark-upload-input" class="hidden" accept="image/png, image/jpeg, image/webp">
                            <button id="upload-watermark-btn" class="w-full bg-gray-700 hover:bg-gray-600 py-3 px-4 rounded-lg font-medium flex items-center justify-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" /></svg> <span>Upload Watermark</span></button>
                            <div id="image-watermark-sliders" class="hidden space-y-4">
                                <!-- MODIFIED: Added value display spans -->
                                <label class="block"><span class="text-sm">Size (<span class="value-display">100</span>px)</span><input type="range" id="image-watermark-size" min="10" max="500" value="100" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"></label>
                                <label class="block"><span class="text-sm">Opacity (<span class="value-display">1</span>)</span><input type="range" id="image-watermark-opacity" min="0" max="1" value="1" step="0.05" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"></label>
                            </div>
                        </div>
                    </div>

                    <div id="export-tab" class="tab-content hidden space-y-4">
                         <h4 class="font-semibold text-gray-200">Export Image</h4>
                        <div class="relative w-full">
                            <select id="format-select" class="custom-select w-full bg-gray-700 text-white font-medium py-3 px-4 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-white/50">
                                <option value="image/png" selected>PNG</option>
                                <option value="image/jpeg">JPEG</option>
                                <option value="image/webp">WebP</option>
                                <option value="image/bmp">BMP</option>
                                <option value="image/gif">GIF</option>
                                <option value="image/tiff">TIFF</option>
                                <option value="image/svg+xml">SVG</option>
                            </select>
                            <svg class="w-5 h-5 absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </div>

                        <div id="quality-control" class="hidden">
                            <div class="flex justify-between items-center">
                                <!-- MODIFIED: Added value display span -->
                                <label for="quality-slider" class="text-sm">Quality (<span class="value-display">90</span>%)</label>
                                <span id="file-size-preview" class="text-sm font-medium text-gray-400"></span>
                            </div>
                            <input type="range" id="quality-slider" min="0.1" max="1.0" value="0.9" step="0.01" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                        </div>
                        <button id="download-btn" class="w-full bg-white hover:bg-gray-200 text-black font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>
                            <span>Download Image</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Ad Sidebar -->
        <aside class="w-[20%] flex-shrink-0 p-3 border-l border-gray-800 hidden lg:block">
            <div class="h-full bg-gray-800/50 rounded-lg flex items-center justify-center text-gray-400">Ad Area</div>
        </aside>
        
        <div id="mobile-nav" class="fixed bottom-0 left-0 w-full lg:hidden bg-gray-800 border-t border-gray-700 shadow-2xl z-40">
            <div class="flex justify-around items-center h-14">
                <button id="mobile-preview-btn" class="mobile-nav-btn flex flex-col items-center justify-center text-xs font-medium w-1/2 active">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    <span>Preview</span>
                </button>
                <button id="mobile-controls-btn" class="mobile-nav-btn flex flex-col items-center justify-center text-xs font-medium w-1/2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75"></path></svg>
                    <span>Controls</span>
                </button>
            </div>
        </div>
    </main>

    <footer class="p-4 w-full flex-shrink-0 border-t border-gray-200 dark:border-gray-800 hidden lg:block">
        <div class="flex flex-col sm:flex-row justify-between items-center text-gray-400 text-sm">
             <div class="flex items-center space-x-3 mb-4 sm:mb-0">
                <svg class="h-6 w-6 text-gray-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5L12 2z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 7l10 5 10-5"></path></svg>
                <span>© 2025 Solite. All Rights Reserved.</span>
            </div>
            <div class="flex items-center space-x-4">
                <a href="./privacy.html" class="hover:text-gray-900 dark:hover:text-white transition-colors">Privacy Policy</a>
                <a href="./terms.html" class="hover:text-gray-900 dark:hover:text-white transition-colors">Terms</a>
                <a href="mailto:support@solite.com" class="hover:text-gray-900 dark:hover:text-white transition-colors">Contact</a>
            </div>
        </div>
    </footer>

    <div id="toast" class="fixed top-0 left-1/2 -translate-x-1/2 bg-white text-black font-semibold py-2 px-5 rounded-b-lg shadow-lg z-50">Success!</div>

    <script>
        (() => {
            // DOM Elements
            const uploadPrompt = document.getElementById('upload-prompt');
            const imageUpload = document.getElementById('image-upload');
            const canvasContainer = document.getElementById('canvas-container');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const controlsPanel = document.getElementById('controls-panel');
            const qualityControl = document.getElementById('quality-control');
            const qualitySlider = document.getElementById('quality-slider');
            const fileSizePreview = document.getElementById('file-size-preview');
            const resetBtn = document.getElementById('reset-btn');
            const removeImageBtn = document.getElementById('remove-image-btn');            
            const applyCropBtn = document.getElementById('apply-crop-btn');
            const resizeWidthInput = document.getElementById('resize-width');
            const resizeHeightInput = document.getElementById('resize-height');
            const undoBtn = document.getElementById('undo-btn');
            const redoBtn = document.getElementById('redo-btn');            
            const aspectLockBtn = document.getElementById('aspect-lock-btn');
            const lockIcon = document.getElementById('lock-icon');
            const unlockIcon = document.getElementById('unlock-icon');
            const downloadBtn = document.getElementById('download-btn');
            const textWatermarkBtn = document.getElementById('text-watermark-btn');
            const imageWatermarkBtn = document.getElementById('image-watermark-btn');
            const watermarkText = document.getElementById('watermark-text');
            const watermarkSize = document.getElementById('watermark-size');
            const watermarkOpacity = document.getElementById('watermark-opacity');
            const watermarkColor = document.getElementById('watermark-color');
            const watermarkUploadInput = document.getElementById('watermark-upload-input');
            const uploadWatermarkBtn = document.getElementById('upload-watermark-btn');
            const imageWatermarkSliders = document.getElementById('image-watermark-sliders');
            const imageWatermarkSize = document.getElementById('image-watermark-size');
            const imageWatermarkOpacity = document.getElementById('image-watermark-opacity');
            const toast = document.getElementById('toast');
            const formatSelect = document.getElementById('format-select');
            
            // Mobile Nav Elements
            const mobilePreviewBtn = document.getElementById('mobile-preview-btn');
            const mobileControlsBtn = document.getElementById('mobile-controls-btn');
            const previewPane = document.getElementById('preview-pane');

            // State variables
            let initialImage = null, originalImage = null, isCropping = false, cropRect = {}, isDragging = false;
            let exportFormat = 'image/png', isAspectLocked = true, history = [], watermarkImage = null, historyIndex = -1;            

            function showToast(message) {
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => { toast.classList.remove('show'); }, 2000);
            }

            function saveState() {
                if (!originalImage) return;
                const state = originalImage.src;
                if (historyIndex < history.length - 1) history = history.slice(0, historyIndex + 1);
                history.push(state);
                historyIndex++;
                updateUndoRedoButtons();
            }

            function undo() {
                if (historyIndex > 0) { historyIndex--; loadState(history[historyIndex]); }
            }

            function redo() {
                if (historyIndex < history.length - 1) { historyIndex++; loadState(history[historyIndex]); }
            }
            
            function loadState(dataUrl) {
                const img = new Image();
                img.onload = () => { originalImage = img; updateCanvas(originalImage); updateUndoRedoButtons(); };
                img.src = dataUrl;
            }
            
            function updateUndoRedoButtons() {
                undoBtn.disabled = historyIndex <= 0;
                redoBtn.disabled = historyIndex >= history.length - 1;
            }

            function handleImage(file) {
                if (!file || !file.type.startsWith('image/')) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        initialImage = img; originalImage = img; history = []; historyIndex = -1;
                        saveState(); updateCanvas(img);
                        uploadPrompt.classList.add('hidden'); canvas.classList.remove('hidden'); removeImageBtn.classList.remove('hidden');
                        imageUpload.value = '';
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }

            function updateCanvas(img) {
                const container = canvasContainer;
                const containerWidth = container.clientWidth - 16; // Account for padding
                const containerHeight = container.clientHeight - 16;

                const imgAspectRatio = img.width / img.height;
                const containerAspectRatio = containerWidth / containerHeight;

                let displayWidth, displayHeight;

                if (imgAspectRatio > containerAspectRatio) {
                    displayWidth = containerWidth;
                    displayHeight = containerWidth / imgAspectRatio;
                } else {
                    displayHeight = containerHeight;
                    displayWidth = containerHeight * imgAspectRatio;
                }
                canvas.width = displayWidth; canvas.height = displayHeight; redrawCanvas();
            }

            function removeImage() {
                initialImage = null; originalImage = null; isCropping = false;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                canvas.classList.add('hidden'); removeImageBtn.classList.add('hidden'); uploadPrompt.classList.remove('hidden');
                resetAllControls();
                history = []; watermarkImage = null; historyIndex = -1; updateUndoRedoButtons(); imageUpload.value = '';
                document.getElementById('watermark-text').value = ''; document.getElementById('watermark-color').value = '#ffffff';
                watermarkImage = null; document.getElementById('image-watermark-sliders').classList.add('hidden'); document.getElementById('watermark-upload-input').value = '';
            }
            
            function resetAllControls() {
                document.querySelectorAll('input[type="range"]').forEach(s => {
                    s.value = s.defaultValue;
                    updateRangeValueDisplay(s); // Update display on reset
                });
                document.querySelectorAll('.filter-btn.active').forEach(b => b.classList.remove('active', 'bg-white', 'text-black'));
                if(isCropping) {
                    document.getElementById('enable-manual-crop').checked = false;
                    toggleCropMode();
                }
                document.getElementById('watermark-text').value = '';
                document.getElementById('watermark-color').value = '#ffffff';
                redrawCanvas();
            }

            function redrawCanvas() {
                if (!originalImage) return;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                const brightness = document.getElementById('brightness-slider').value;
                const contrast = document.getElementById('contrast-slider').value;
                const blur = document.getElementById('blur-slider').value;
                let filterString = `brightness(${100 + Number(brightness)}%) contrast(${100 + Number(contrast)}%) blur(${blur}px) `;
                const activeFilter = document.querySelector('.filter-btn.active');
                if (activeFilter) {
                    const filter = activeFilter.dataset.filter;
                    if (filter === 'grayscale') filterString += 'grayscale(100%)';
                    if (filter === 'sepia') filterString += 'sepia(100%)';
                    if (filter === 'invert') filterString += 'invert(100%)';
                }
                
                ctx.save();
                ctx.filter = filterString;
                ctx.drawImage(originalImage, 0, 0);
                ctx.restore();

                const isTextWatermark = textWatermarkBtn.classList.contains('bg-white');
                if (isTextWatermark && watermarkText.value) {
                    ctx.save();
                    ctx.globalAlpha = watermarkOpacity.value; ctx.fillStyle = watermarkColor.value;
                    ctx.font = `bold ${watermarkSize.value}px sans-serif`;
                    ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                    ctx.fillText(watermarkText.value, canvas.width / 2, canvas.height / 2);
                    ctx.restore();
                } else if (watermarkImage && imageWatermarkBtn.classList.contains('bg-white')) {
                    ctx.save();
                    ctx.globalAlpha = document.getElementById('image-watermark-opacity').value;
                    const w = imageWatermarkSize.value; const h = (w / watermarkImage.width) * watermarkImage.height;
                    const x = (canvas.width - w) / 2; const y = (canvas.height - h) / 2;
                    ctx.drawImage(watermarkImage, x, y, w, h);
                    ctx.restore();
                }
                if (isCropping) drawCropOverlay();
            }

            function resizeImage() {
                const width = parseInt(resizeWidthInput.value);
                const height = parseInt(document.getElementById('resize-height').value);
                if (!width || !height || width <= 0 || height <= 0) return;
                
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = width; tempCanvas.height = height;
                tempCanvas.getContext('2d').drawImage(originalImage, 0, 0, width, height);
                
                const img = new Image();
                img.onload = () => { originalImage = img; saveState(); updateCanvas(originalImage); showToast('Image resized.'); }
                img.src = tempCanvas.toDataURL();
            }

            function clipShape(shape) {
                if (!originalImage) return;
                const tempCanvas = document.createElement('canvas'); const tempCtx = tempCanvas.getContext('2d');
                const w = originalImage.width; const h = originalImage.height;
                tempCanvas.width = w; tempCanvas.height = h;
                
                tempCtx.save(); tempCtx.beginPath();
                switch(shape) {
                    case 'circle': tempCtx.arc(w/2, h/2, Math.min(w, h)/2, 0, Math.PI*2); break;
                    case 'star': { let rot = Math.PI/2*3, x = w/2, y = h/2, outerR = Math.min(w,h)/2, innerR = outerR/2; tempCtx.moveTo(x, y-outerR); for(let i=0; i<5; i++){ tempCtx.lineTo(x+Math.cos(rot)*outerR, y+Math.sin(rot)*outerR); rot += Math.PI/5; tempCtx.lineTo(x+Math.cos(rot)*innerR, y+Math.sin(rot)*innerR); rot += Math.PI/5; } break; }
                    case 'hexagon': { let side = Math.min(w, h)/2; tempCtx.moveTo(w/2+side, h/2); for(let i=1; i<=6; i++) tempCtx.lineTo(w/2+side*Math.cos(i*2*Math.PI/6), h/2+side*Math.sin(i*2*Math.PI/6)); break; }
                    case 'blob': tempCtx.moveTo(w*0.5,h*0.1); tempCtx.bezierCurveTo(w*0.9,h*-0.1, w*1.1,h*0.9, w*0.5,h*0.9); tempCtx.bezierCurveTo(w*-0.1,h*0.9, w*0.1,h*-0.1, w*0.5,h*0.1); break;
                    case 'heart': tempCtx.moveTo(w/2,h/4); tempCtx.bezierCurveTo(w/2,h/5,w/4,0,0,h/4); tempCtx.bezierCurveTo(-w/3,h,w/2,h,w/2,h); tempCtx.bezierCurveTo(w/2,h,w+w/3,h,w,h/4); tempCtx.bezierCurveTo(w*3/4,0,w/2,h/5,w/2,h/4); break;
                    case 'triangle': tempCtx.moveTo(w/2,0); tempCtx.lineTo(w,h); tempCtx.lineTo(0,h); break;
                }
                tempCtx.closePath(); tempCtx.clip(); tempCtx.drawImage(originalImage, 0, 0); tempCtx.restore();

                const img = new Image();
                img.onload = () => { originalImage = img; saveState(); updateCanvas(img); showToast(`${shape.charAt(0).toUpperCase() + shape.slice(1)} crop applied.`); };
                img.src = tempCanvas.toDataURL('image/png');
            }
            
            function cropToAspectRatio(ratioStr) {
                if (!originalImage) return;
                const [ratioW, ratioH] = ratioStr.split(':').map(Number);
                const imgW = originalImage.width, imgH = originalImage.height;
                let cropW, cropH, cropX, cropY;
                if ((imgW/imgH) > (ratioW/ratioH)) { cropH = imgH; cropW = imgH * (ratioW/ratioH); } 
                else { cropW = imgW; cropH = imgW * (ratioH/ratioW); }
                cropX = (imgW-cropW)/2; cropY = (imgH-cropH)/2;
                
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = cropW; tempCanvas.height = cropH;
                tempCanvas.getContext('2d').drawImage(originalImage, cropX, cropY, cropW, cropH, 0, 0, cropW, cropH);
                
                const img = new Image();
                img.onload = () => { originalImage = img; saveState(); updateCanvas(originalImage); showToast(`${ratioStr} crop applied.`); }
                img.src = tempCanvas.toDataURL();
            }

            function applyCrop() {
                if (!cropRect.w || !cropRect.h) return;
                const x = cropRect.w < 0 ? cropRect.x + cropRect.w : cropRect.x;
                const y = cropRect.h < 0 ? cropRect.y + cropRect.h : cropRect.y;
                const w = Math.abs(cropRect.w); const h = Math.abs(cropRect.h);

                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = w; tempCanvas.height = h;
                tempCanvas.getContext('2d').drawImage(originalImage, x, y, w, h, 0, 0, w, h);
                
                const img = new Image();
                img.onload = () => {
                    originalImage = img; document.getElementById('enable-manual-crop').checked = false;
                    toggleCropMode(); saveState(); updateCanvas(originalImage); showToast('Crop applied.');
                }
                img.src = tempCanvas.toDataURL();
            }

            function toggleCropMode() {
                isCropping = document.getElementById('enable-manual-crop').checked;
                canvasContainer.style.cursor = isCropping ? 'crosshair' : 'default';
                if (!isCropping) { cropRect = {}; applyCropBtn.disabled = true; redrawCanvas(); }
            }
            
            function drawCropOverlay() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.5)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
                if (cropRect.w && cropRect.h) {
                    ctx.strokeStyle = '#FFFFFF'; ctx.lineWidth = 2;
                    ctx.strokeRect(cropRect.x, cropRect.y, cropRect.w, cropRect.h);
                    ctx.clearRect(cropRect.x, cropRect.y, cropRect.w, cropRect.h);
                }
            }
            
            function showTab(tabId) {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('text-white', 'border-white'));
                document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('text-white', 'border-white');
                document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                document.getElementById(`${tabId}-tab`).classList.remove('hidden');
            }
            
            function updateFileSizePreview() {
                if (!originalImage || !canvas) return;
                if (exportFormat === 'image/jpeg' || exportFormat === 'image/webp') {
                    try {
                        const quality = parseFloat(qualitySlider.value);
                        const dataUrl = canvas.toDataURL(exportFormat, quality);
                        const sizeInBytes = atob(dataUrl.split(',')[1]).length;
                        fileSizePreview.textContent = sizeInBytes > 1048576 ? `${(sizeInBytes/1048576).toFixed(2)} MB` : `${(sizeInBytes/1024).toFixed(1)} KB`;
                    } catch (e) { fileSizePreview.textContent = "Error"; }
                } else { fileSizePreview.textContent = ''; }
            }
            
            // --- MODIFIED: Function to update dynamic value displays for sliders ---
            function updateRangeValueDisplay(inputElement) {
                const displaySpan = inputElement.previousElementSibling?.querySelector('.value-display');
                if (!displaySpan) return;

                let value = inputElement.value;
                switch(inputElement.id) {
                    case 'quality-slider':
                        displaySpan.textContent = Math.round(value * 100);
                        break;
                    case 'blur-slider':
                    case 'watermark-size':
                    case 'image-watermark-size':
                        displaySpan.textContent = value;
                        break;
                    case 'watermark-opacity':
                    case 'image-watermark-opacity':
                         displaySpan.textContent = parseFloat(value).toFixed(2);
                         break;
                    default:
                        displaySpan.textContent = value;
                        break;
                }
            }

            function setupColorPresets() {
                const colors = ['#FFFFFF', '#000000', '#EF4444', '#F59E0B', '#10B981', '#3B82F6', '#6366F1', '#EC4899'];
                const container = document.getElementById('color-presets'); container.innerHTML = '';
                colors.forEach(color => {
                    const swatch = document.createElement('button');
                    swatch.type = "button"; swatch.className = "w-full h-6 rounded border border-gray-500";
                    swatch.style.backgroundColor = color;
                    swatch.addEventListener('click', () => { watermarkColor.value = color; redrawCanvas(); });
                    container.appendChild(swatch);
                });
            }

            // --- Event Listeners ---
            uploadPrompt.addEventListener('click', () => imageUpload.click());
            imageUpload.addEventListener('change', (e) => handleImage(e.target.files[0]));
            canvasContainer.addEventListener('dragover', (e) => { e.preventDefault(); canvasContainer.classList.add('border-blue-500'); });
            canvasContainer.addEventListener('dragleave', () => canvasContainer.classList.remove('border-blue-500'));
            canvasContainer.addEventListener('drop', (e) => { e.preventDefault(); canvasContainer.classList.remove('border-blue-500'); handleImage(e.dataTransfer.files[0]); });
            removeImageBtn.addEventListener('click', removeImage);
            resetBtn.addEventListener('click', () => {
                if (initialImage) { 
                    loadState(initialImage.src); history = [initialImage.src]; historyIndex = 0; updateUndoRedoButtons();
                }
                resetAllControls();
            });
            undoBtn.addEventListener('click', undo);
            redoBtn.addEventListener('click', redo);
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const wasActive = btn.classList.contains('active');
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active', 'bg-white', 'text-black'));
                    if(!wasActive) btn.classList.add('active', 'bg-white', 'text-black');
                    redrawCanvas();
                });
            });

            // --- MODIFIED: Consolidated event listener for all controls ---
            controlsPanel.addEventListener('input', (e) => {
                if (e.target.type === 'range') {
                    updateRangeValueDisplay(e.target);
                    if (e.target.id === 'quality-slider') {
                        updateFileSizePreview();
                    }
                }
                if (e.target.closest('#adjust-tab, #watermark-tab, #quality-slider')) {
                    redrawCanvas();
                }
            });

            uploadWatermarkBtn.addEventListener('click', () => watermarkUploadInput.click());
            watermarkUploadInput.addEventListener('change', (e) => {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        watermarkImage = new Image();
                        watermarkImage.onload = () => { imageWatermarkSliders.classList.remove('hidden'); redrawCanvas(); };
                        watermarkImage.src = event.target.result;
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            });

            textWatermarkBtn.addEventListener('click', () => {
                textWatermarkBtn.classList.add('bg-white', 'text-black'); textWatermarkBtn.classList.remove('text-gray-300');
                imageWatermarkBtn.classList.remove('bg-white', 'text-black'); imageWatermarkBtn.classList.add('text-gray-300');
                document.getElementById('text-watermark-controls').classList.remove('hidden'); document.getElementById('image-watermark-controls').classList.add('hidden');
                redrawCanvas();
            });
            imageWatermarkBtn.addEventListener('click', () => {
                imageWatermarkBtn.classList.add('bg-white', 'text-black'); imageWatermarkBtn.classList.remove('text-gray-300');
                textWatermarkBtn.classList.remove('bg-white', 'text-black'); textWatermarkBtn.classList.add('text-gray-300');
                document.getElementById('image-watermark-controls').classList.remove('hidden'); document.getElementById('text-watermark-controls').classList.add('hidden');
                redrawCanvas();
            });

            document.getElementById('apply-resize-btn').addEventListener('click', resizeImage);            
            document.querySelectorAll('.aspect-crop-btn').forEach(btn => btn.addEventListener('click', () => cropToAspectRatio(btn.dataset.ratio)));
            document.querySelectorAll('.shape-crop-btn').forEach(btn => btn.addEventListener('click', () => clipShape(btn.dataset.shape)));
            
            aspectLockBtn.addEventListener('click', () => {
                isAspectLocked = !isAspectLocked;
                lockIcon.classList.toggle('hidden', !isAspectLocked); unlockIcon.classList.toggle('hidden', isAspectLocked);
                aspectLockBtn.classList.toggle('bg-white', isAspectLocked); aspectLockBtn.classList.toggle('text-black', isAspectLocked);
                aspectLockBtn.classList.toggle('bg-gray-700', !isAspectLocked); aspectLockBtn.classList.toggle('text-white', !isAspectLocked);
            });

            resizeWidthInput.addEventListener('input', () => {
                if (isAspectLocked && originalImage) { resizeHeightInput.value = Math.round(resizeWidthInput.value * (originalImage.height / originalImage.width)); }
            });
            resizeHeightInput.addEventListener('input', () => {
                if (isAspectLocked && originalImage) { resizeWidthInput.value = Math.round(resizeHeightInput.value * (originalImage.width / originalImage.height)); }
            });

            document.getElementById('enable-manual-crop').addEventListener('change', toggleCropMode);            
            applyCropBtn.addEventListener('click', applyCrop);
            
            canvas.addEventListener('mousedown', (e) => {
                const rect = canvas.getBoundingClientRect(); const scaleX = canvas.width / rect.width; const scaleY = canvas.height / rect.height;
                const mouseX = (e.clientX - rect.left) * scaleX; const mouseY = (e.clientY - rect.top) * scaleY;
                if (isCropping) { isDragging = true; cropRect = { x: mouseX, y: mouseY, w: 0, h: 0 }; }
            });

            canvas.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                const rect = canvas.getBoundingClientRect(); const scaleX = canvas.width / rect.width; const scaleY = canvas.height / rect.height;
                const mouseX = (e.clientX - rect.left) * scaleX; const mouseY = (e.clientY - rect.top) * scaleY;
                cropRect.w = mouseX - cropRect.x; cropRect.h = mouseY - cropRect.y;
                redrawCanvas();
            });

            canvas.addEventListener('mouseup', () => {
                if (isCropping && cropRect.w && cropRect.h) applyCropBtn.disabled = false; isDragging = false;
            });
            canvas.addEventListener('mouseleave', () => { if(isDragging) { applyCropBtn.disabled = false; isDragging = false; } });

            function handleFormatChange() {
                exportFormat = formatSelect.value;
                const showQuality = exportFormat === 'image/jpeg' || exportFormat === 'image/webp';
                qualityControl.classList.toggle('hidden', !showQuality);
                if (showQuality) { updateRangeValueDisplay(qualitySlider); updateFileSizePreview(); }
            }
            
            formatSelect.addEventListener('change', handleFormatChange);

            downloadBtn.addEventListener('click', () => {
                redrawCanvas();
                const link = document.createElement('a'); const ext = exportFormat.split('/')[1].split('+')[0];
                link.download = `solite-edited-image.${ext}`;
                link.href = canvas.toDataURL(exportFormat, parseFloat(qualitySlider.value));
                link.click(); showToast('Downloading image...');
            });
            
            document.querySelectorAll('.tab').forEach(tab => tab.addEventListener('click', () => showTab(tab.dataset.tab)));
            
            function handleMobileLayout() {
                if (window.innerWidth < 1024) {
                    const isActive = mobilePreviewBtn.classList.contains('active') || mobileControlsBtn.classList.contains('active');
                    if (!isActive) {
                        controlsPanel.classList.add('hidden'); previewPane.classList.remove('hidden'); previewPane.classList.add('flex'); mobilePreviewBtn.classList.add('active');
                    }
                } else {
                    controlsPanel.classList.remove('hidden'); controlsPanel.classList.add('flex');
                    previewPane.classList.remove('hidden'); previewPane.classList.add('flex');
                    mobilePreviewBtn.classList.remove('active'); mobileControlsBtn.classList.remove('active');
                }
            }

            mobilePreviewBtn.addEventListener('click', () => {
                controlsPanel.classList.add('hidden'); previewPane.classList.remove('hidden'); previewPane.classList.add('flex');
                mobilePreviewBtn.classList.add('active'); mobileControlsBtn.classList.remove('active');
            });

            mobileControlsBtn.addEventListener('click', () => {
                previewPane.classList.add('hidden'); controlsPanel.classList.remove('hidden'); controlsPanel.classList.add('flex');
                mobileControlsBtn.classList.add('active'); mobilePreviewBtn.classList.remove('active');
            });

            window.addEventListener('resize', handleMobileLayout);

            // Initial Setup
            showTab('adjust'); setupColorPresets(); handleMobileLayout(); handleFormatChange();
            // Set initial display values for all range sliders on load
            document.querySelectorAll('input[type="range"]').forEach(updateRangeValueDisplay);
            
        })();
    </script>
</body>
</html>