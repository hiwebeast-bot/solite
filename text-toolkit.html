<!DOCTYPE html>
<html lang="en" class="scroll-smooth dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- MODIFIED: Optimized Title -->
    <title>All-in-One Text Toolkit: Cleaner, Analyzer &amp; Regex Find/Replace | Solite</title>

    <!-- SEO & Social Sharing Meta Tags -->
    <meta name="description" content="The ultimate, all-in-one text toolkit from Solite. Clean formatting, find & replace with Regex, analyze readability, change case, and more. 100% private.">
    <!-- MODIFIED: Expanded Keywords -->
    <meta name="keywords" content="solite, text tools, find and replace, regex checker, text cleaner, readability score, text analysis, privacy first, text analyzer, text formatting, case converter, JSON formatter, find and replace regex">
    <link rel="canonical" href="https://solite.in/text-toolkit.html" />
    <!-- MODIFIED: Optimized OG Title -->
    <meta property="og:title" content="All-in-One Text Toolkit: Cleaner, Analyzer &amp; Regex Find/Replace | Solite">
    <meta property="og:description" content="The ultimate, all-in-one text toolkit from Solite. Clean formatting, find & replace with Regex, analyze readability, change case, and more. 100% private.">
    <meta property="og:site_name" content="Solite">
    <meta property="og:image" content="https://solite.in/assets/solite-text-toolkit-og.png">
    <meta property="og:url" content="https://solite.in/text-toolkit.html">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">

    <!-- AdSense Meta Tag -->
    <meta name="google-adsense-account" content="ca-pub-6623613371208692">

    <!-- Schema.org Markup -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Text Tools",
      "url": "https://solite.in/text-toolkit.html",
      "description": "An all-in-one text toolkit to clean formatting, find & replace with Regex, analyze readability, change case, and more.",
      "applicationCategory": "UtilitiesApplication",
      "featureList": [
        "Strip all formatting from text",
        "Remove extra spaces and line breaks",
        "Convert text case (UPPERCASE, lowercase, Sentence case, Title Case)",
        "Extract emails and URLs",
        "Sort lines alphabetically",
        "Remove duplicate lines",
        "Format JSON",
        "Find and replace with case sensitivity and Regex support",
        "Text analysis (word count, character count, reading time, readability score)",
        "Undo/Redo functionality"
      ],
      "operatingSystem": "All",
      "browserRequirements": "Requires a modern web browser with JavaScript enabled.",
      "provider": {
        "@type": "Organization",
        "name": "Solite",
        "url": "https://solite.in"
      }
    }
    </script>

    <!-- Vercel Analytics -->
    <script>
        window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments); };
    </script>
    <script src="/_vercel/insights/script.js" defer></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <style>
        #toast {
            transform: translateY(-150%);
            transition: transform 0.3s ease-in-out;
        }
        #toast.show {
            transform: translateY(2rem);
        }
        .custom-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        /* Custom Scrollbar for Webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #111827; /* gray-900 */
        }
        ::-webkit-scrollbar-thumb {
            background-color: #4b5563; /* gray-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background-color: #6b7280; /* gray-500 */
        }
        /* Custom Scrollbar for Firefox */
        html { scrollbar-color: #4b5563 #111827; }
        
        /* ADDED: Mobile Nav Styles */
        .mobile-nav-btn.active {
            color: #ffffff; /* white */
        }
        .mobile-nav-btn {
            color: #9ca3af; /* gray-400 */
        }
        /* REMOVED: Mobile viewport height fix */
    </style>
</head>
<!-- MODIFIED: Removed overflow-hidden to allow content scroll if needed, set min-h-screen -->
<body class="bg-black text-gray-200 flex flex-col min-h-screen font-sans">
    
    <!-- MODIFIED: Header updated to mobile-first version -->
    <header class="p-3 sm:p-4 w-full flex-shrink-0 sticky top-0 bg-white/80 dark:bg-black/80 backdrop-blur-xl z-30 border-b border-gray-200 dark:border-gray-800">
        <div class="flex justify-between items-center">
            <a href="index.html" class="flex flex-col space-y-1 lg:flex-row lg:items-center lg:space-x-3 lg:space-y-0" aria-label="Solite Homepage">
                <div class="flex items-center space-x-3">
                     <svg class="h-6 w-6 lg:h-8 lg:w-8 text-gray-900 dark:text-white flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2L2 7l10 5 10-5L12 2z"></path>
                        <path d="M2 17l10 5 10-5"></path>
                        <path d="M2 7l10 5 10-5"></path>
                    </svg>
                    <span class="text-base lg:text-xl font-bold text-gray-900 dark:text-white uppercase tracking-wider leading-none">Solite</span>
                </div>
                <span class="h-6 w-px bg-gray-300 dark:bg-gray-700 hidden lg:block"></span>
                <span class="text-lg lg:text-lg font-semibold text-gray-600 dark:text-gray-400 leading-none">Text Tools</span>
            </a>
             <div class="flex items-center space-x-4">
                <a href="index.html#apps" class="bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-gray-700 text-gray-800 dark:text-white font-medium py-2 px-4 rounded-lg transition-colors flex items-center space-x-1.5">
                    <span>Free Tools</span>
                    <svg class="h-4 w-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5-5 5"></path></svg>
                </a>
            </div>
        </div>
    </header>
    <!-- MODIFIED: Updated sr-only h1 -->
    <h1 class="sr-only">All-in-One Text Toolkit: Cleaner, Analyzer &amp; Regex Find/Replace</h1>
    <!-- MODIFIED: Added relative for mobile nav -->
    <main class="flex-grow flex min-h-0 relative">
        <!-- MODIFIED: Reverted to flex-col. Removed lg:flex-row and lg:gap-4 -->
        <div class="flex-grow w-full lg:w-[80%] p-3 pb-16 lg:pb-3 flex flex-col min-h-0">
        
        <!-- MODIFIED: Wrapped toolbars in 'tools-pane' div -->
        <!-- MODIFIED: Reverted classes. Removed lg:w-96, lg:overflow-y-auto, etc. -->
        <div id="tools-pane" class="lg:block">
            <!-- Command Bar -->
            <div class="w-full mb-4 p-3 bg-gray-100 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row items-center justify-between gap-4" role="toolbar">
                <div class="flex-grow flex items-center space-x-3 w-full sm:w-auto">
                    <label for="transform-select" class="text-gray-900 dark:text-white font-semibold flex-shrink-0 font-sans">Action:</label>
                    <div class="relative w-full sm:w-auto h-full flex-grow">
                        <select id="transform-select" class="custom-select w-full bg-gray-700 text-white font-medium py-2 pl-3 pr-8 rounded-md border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                            <optgroup label="Cleaner">
                                <option value="stripAll" selected>Strip All Formatting</option>
                                <option value="removeExtraSpaces">Remove Extra Spaces</option>
                                <option value="removeLineBreaks">Remove All Line Breaks</option>
                            </optgroup>
                            <optgroup label="Case Converter">
                                <option value="toUpperCase">UPPERCASE</option>
                                <option value="toLowerCase">lowercase</option>
                                <option value="toSentenceCase">Sentence case</option>
                                <option value="toTitleCase">Title Case</option>
                            </optgroup>
                            <optgroup label="Tools">
                                <option value="extractEmails">Extract Emails</option>
                                <option value="extractUrls">Extract URLs</option>
                                <option value="sortLinesAZ">Sort Lines (A-Z)</option>
                                <option value="removeDuplicateLines">Remove Duplicate Lines</option>
                            </optgroup>
                            <optgroup label="Developer">
                                <option value="formatJson">Format JSON</option>
                            </optgroup>
                        </select>
                        <svg class="w-4 h-4 absolute right-2.5 top-1/2 -translate-y-1/2 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                </div>
                 <div class="flex items-center space-x-2 flex-shrink-0">
                     <button id="undo-btn" aria-label="Undo" title="Undo (Ctrl+Z)" class="bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-white p-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"></path></svg></button>
                     <button id="redo-btn" aria-label="Redo" title="Redo (Ctrl+Y)" class="bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-white p-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg></button>
                     <button id="clear-btn" aria-label="Clear Text" title="Clear Text" class="bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-white p-2 rounded-lg"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>
                     <button id="copy-btn" class="bg-white hover:bg-gray-200 text-black font-medium py-2 px-4 rounded-lg flex items-center space-x-2">
                        <svg id="copy-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                        <span id="copy-text">Copy</span>
                    </button>
                </div>
            </div>
            
            <!-- Find & Replace -->
            <div class="w-full mb-4 p-3 bg-gray-100 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row items-center gap-4" role="search">
                <input type="text" id="find-input" aria-label="Find text" placeholder="Find..." class="flex-grow p-2 rounded-lg bg-gray-700 border-gray-600 focus:outline-none focus:border-white/50 focus:ring-2 focus:ring-white/50 w-full">
                <input type="text" id="replace-input" aria-label="Replace with text" placeholder="Replace with..." class="flex-grow p-2 rounded-lg bg-gray-700 border-gray-600 focus:outline-none focus:border-white/50 focus:ring-2 focus:ring-white/50 w-full">
                <div class="flex items-center space-x-4 text-sm w-full sm:w-auto">
                    <label class="flex items-center space-x-2 cursor-pointer p-1 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700">
                        <input type="checkbox" id="case-sensitive" class="h-4 w-4 rounded bg-gray-700 border-gray-600 text-blue-500 focus:ring-blue-500">
                        <span>Case Sensitive</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer p-1 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700">
                        <input type="checkbox" id="use-regex" class="h-4 w-4 rounded bg-gray-700 border-gray-600 text-blue-500 focus:ring-blue-500">
                        <span>Regex</span>
                    </label>
                    <button id="replace-all-btn" class="bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg">Replace All</button>
                </div>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <!-- MODIFIED: This wrapper now acts as the main content block (Cols 2 & 3) -->
        <div class="w-full flex-grow flex flex-col gap-4 min-h-0">
            <!-- MODIFIED: Added lg:flex-row, gave 'text-pane' ID -->
            <div id="text-pane" class="flex-grow flex flex-col lg:flex-row gap-4 min-h-0">
                <!-- Main Workspace -->
                <!-- MODIFIED: Removed h-[60vh] lg:h-auto -->
                <div class="flex-1 flex-grow flex flex-col" role="main">
                    <!-- MODIFIED: Added flex-col lg:flex-row for mobile stacking -->
                    <div class="flex-grow flex relative bg-gray-200 dark:bg-gray-700 rounded-lg flex-col lg:flex-row">
                        <!-- MODIFIED: w-full h-1/2 lg:w-1/2 lg:h-full, updated rounding -->
                        <textarea id="input-text" aria-label="Input Text" class="w-full h-1/2 lg:w-1/2 lg:h-full p-4 rounded-t-lg lg:rounded-l-lg lg:rounded-t-none bg-gray-800 border-gray-700 text-gray-300 focus:outline-none focus:ring-2 focus:ring-white/50" placeholder="Paste your text here..."></textarea>
                        
                        <!-- MODIFIED: Added mobile-specific rotation/position for swap button -->
                        <button id="swap-btn" aria-label="Swap Input and Output" title="Swap Input/Output" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-gray-600 hover:bg-gray-500 rounded-full p-2 z-10 transition-transform hover:scale-110 lg:rotate-0 rotate-90"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 16V4m0 12l-4-4m4 4l4-4m6 8v12M17 8l-4 4m4-4l4 4"></path></svg></button>
                        
                        <!-- MODIFIED: w-full h-1/2 lg:w-1/2 lg:h-full, updated rounding and border -->
                        <textarea id="output-text" aria-label="Output Text" readonly class="w-full h-1/2 lg:w-1/2 lg:h-full p-4 rounded-b-lg lg:rounded-r-lg lg:rounded-b-none bg-gray-900 border-t lg:border-t-0 lg:border-l border-gray-700 text-gray-300 focus:outline-none" placeholder="Result appears here..."></textarea>
                    </div>
                </div>

                <!-- Analysis Panel -->
                <!-- MODIFIED: Added overflow-y-auto for mobile scrolling -->
                <div id="analysis-panel" class="w-full lg:w-72 flex-shrink-0 bg-gray-100 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 overflow-y-auto">
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-4">Text Analysis</h3>
                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between"><span>Readability Score:</span><strong id="stat-readability">N/A</strong></div>
                        <div class="flex justify-between"><span>Reading Time:</span><strong id="stat-reading-time">~ 0 min</strong></div>
                        <div class="flex justify-between"><span>Speaking Time:</span><strong id="stat-speaking-time">~ 0 min</strong></div>
                        <hr class="border-gray-300 dark:border-gray-600 my-2">
                        <div class="flex justify-between"><span>Words:</span><strong id="stat-words">0</strong></div>
                        <div class="flex justify-between"><span>Characters:</span><strong id="stat-chars">0</strong></div>
                        <div class="flex justify-between"><span>Sentences:</span><strong id="stat-sentences">0</strong></div>
                        <div class="flex justify-between"><span>Paragraphs:</span><strong id="stat-paragraphs">0</strong></div>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <!-- Ad Sidebar -->
        <aside class="w-[20%] flex-shrink-0 p-3 border-l border-gray-800 hidden lg:block">
            <div class="h-full bg-gray-800/50 rounded-lg flex items-center justify-center text-gray-400">
                Ad Area
            </div>
        </aside>
        
        <!-- ADDED: Mobile/Tablet Navigation Bar -->
        <div id="mobile-nav" class="fixed bottom-0 left-0 w-full lg:hidden bg-gray-800 border-t border-gray-700 shadow-2xl z-40">
            <div class="flex justify-around items-center h-14">
                <button id="mobile-text-btn" class="mobile-nav-btn flex flex-col items-center justify-center text-xs font-medium w-1/3 active">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"></path></svg>
                    <span>Text</span>
                </button>
                <button id="mobile-tools-btn" class="mobile-nav-btn flex flex-col items-center justify-center text-xs font-medium w-1/3">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75"></path></svg>
                    <span>Tools</span>
                </button>
                <button id="mobile-analysis-btn" class="mobile-nav-btn flex flex-col items-center justify-center text-xs font-medium w-1/3">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M7.5 14.25v2.25m3-4.5v4.5m3-6.75v6.75m3-9v9M6 20.25h12A2.25 2.25 0 0020.25 18V6A2.25 2.25 0 0018 3.75H6A2.25 2.25 0 003.75 6v12A2.25 2.25 0 006 20.25z"></path></svg>
                    <span>Analysis</span>
                </button>
            </div>
        </div>
    </main>

    <!-- MODIFIED: Hidden footer on mobile -->
    <footer class="p-4 w-full flex-shrink-0 border-t border-gray-800 hidden lg:block">
        <div class="flex flex-col sm:flex-row justify-between items-center text-gray-400 text-sm">
             <div class="flex items-center space-x-3 mb-4 sm:mb-0">
                <svg class="h-6 w-6 text-gray-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5L12 2z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 7l10 5 10-5"></path></svg>
                <span>© 2024 Solite. All Rights Reserved.</span>
            </div>
            <div class="flex items-center space-x-4">
                <a href="./privacy.html" class="hover:text-white transition-colors">Privacy Policy</a>
                <a href="./terms.html" class="hover:text-white transition-colors">Terms</a>
                <a href="mailto:support@solite.com" class="hover:text-gray-900 dark:hover:text-white transition-colors">Contact</a>
            </div>
        </div>
    </footer>
    
    <!-- Toast Notification -->
    <div id="toast" class="fixed top-0 left-1/2 -translate-x-1/2 bg-white text-black font-semibold py-2 px-5 rounded-b-lg shadow-lg z-50">Copied!</div>

    <!-- REMOVED: Mobile viewport height fix script -->

    <script>
        // Main App Logic
        (() => {
            function init() {
                const inputText = document.getElementById('input-text');
                const outputText = document.getElementById('output-text');
                const transformSelect = document.getElementById('transform-select');
                const copyBtn = document.getElementById('copy-btn');
                const clearBtn = document.getElementById('clear-btn');
                const undoBtn = document.getElementById('undo-btn');
                const redoBtn = document.getElementById('redo-btn');
                const findInput = document.getElementById('find-input');
                const replaceInput = document.getElementById('replace-input');
                const caseSensitive = document.getElementById('case-sensitive');
                const useRegex = document.getElementById('use-regex');
                const replaceAllBtn = document.getElementById('replace-all-btn');
                const swapBtn = document.getElementById('swap-btn');
                const statReadability = document.getElementById('stat-readability');
                const statReadingTime = document.getElementById('stat-reading-time');
                const statSpeakingTime = document.getElementById('stat-speaking-time');
                const statWords = document.getElementById('stat-words');
                const statChars = document.getElementById('stat-chars');
                const statSentences = document.getElementById('stat-sentences');
                const statParagraphs = document.getElementById('stat-paragraphs');
                const toast = document.getElementById('toast');
                
                // ADDED: Mobile Nav Elements
                const mobileTextBtn = document.getElementById('mobile-text-btn');
                const mobileToolsBtn = document.getElementById('mobile-tools-btn');
                const mobileAnalysisBtn = document.getElementById('mobile-analysis-btn');
                const textPane = document.getElementById('text-pane');
                const toolsPane = document.getElementById('tools-pane');
                const analysisPane = document.getElementById('analysis-panel');
                const allPanes = [textPane, toolsPane, analysisPane];
                const allBtns = [mobileTextBtn, mobileToolsBtn, mobileAnalysisBtn];


                let textHistory = [];
                let redoHistory = [];

                // ... (existing transformations object)
                const transformations = {
                    stripAll: (t) => { const el = document.createElement('div'); el.innerHTML = t; return (el.textContent || "").replace(/(\r\n|\n|\r){2,}/g, '$1\n').trim(); },
                    removeExtraSpaces: (t) => t.replace(/ +/g, ' ').trim(),
                    removeLineBreaks: (t) => t.replace(/(\r\n|\n|\r)+/g, ' ').replace(/ +/g, ' ').trim(),
                    toUpperCase: (t) => t.toUpperCase(),
                    toLowerCase: (t) => t.toLowerCase(),
                    toSentenceCase: (t) => t.toLowerCase().replace(/(^\s*\w|[.!?]\s*\w)/g, c => c.toUpperCase()),
                    toTitleCase: (t) => {
                        const small = /^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;
                        return t.toLowerCase().split(' ').map((w, i) => (i === 0 || !small.test(w)) ? w.charAt(0).toUpperCase() + w.slice(1) : w).join(' ');
                    },
                    formatJson: (t) => { if (!t.trim()) return ''; try { return JSON.stringify(JSON.parse(t), null, 2); } catch (e) { return "Invalid JSON: " + e.message; } },
                    extractEmails: (t) => ([...new Set(t.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)/gi) || [])].join('\n') || 'No emails found.'),
                    extractUrls: (t) => ([...new Set(t.match(/(https?:\/\/[^\s"'<>`]+)/gi) || [])].join('\n') || 'No URLs found.'),
                    sortLinesAZ: (t) => t.split('\n').filter(l => l.trim() !== '').sort((a, b) => a.localeCompare(b)).join('\n'),
                    removeDuplicateLines: (t) => [...new Set(t.split('\n'))].join('\n')
                };

                const debounce = (func, delay = 200) => { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => func.apply(this, a), delay); }; };

                function pushToHistory(text, clearRedo = true) {
                    if (textHistory.length === 0 || textHistory[textHistory.length - 1] !== text) {
                        textHistory.push(text);
                        if (textHistory.length > 50) textHistory.shift();
                        if (clearRedo) redoHistory = [];
                    }
                    undoBtn.disabled = textHistory.length <= 1;
                    redoBtn.disabled = redoHistory.length === 0;
                }

                function updateOutput() {
                    const transform = transformations[transformSelect.value] || (text => text);
                    outputText.value = transform(inputText.value);
                    updateAnalysis(inputText.value);
                    saveSession();
                }

                function updateAnalysis(text) {
                    const words = (text.match(/\S+/g) || []).length;
                    const chars = text.length;
                    const sentences = (text.match(/[\w|\)].?!/g) || []).length;
                    const paragraphs = (text.split(/\n\s*\n/).filter(p => p.trim().length > 0)).length;
                    statWords.textContent = words; statChars.textContent = chars;
                    statSentences.textContent = sentences > 0 ? sentences : (words > 0 ? 1 : 0);
                    statParagraphs.textContent = paragraphs > 0 ? paragraphs : (words > 0 ? 1 : 0);
                    statReadingTime.textContent = `~ ${Math.ceil(words / 238)} min`;
                    statSpeakingTime.textContent = `~ ${Math.ceil(words / 180)} min`;
                    if (words > 10 && sentences > 0) {
                        const score = 206.835 - 1.015 * (words / sentences) - 84.6 * (text.replace(/\s/g, '').length / words);
                        statReadability.textContent = score.toFixed(1);
                    } else { statReadability.textContent = 'N/A'; }
                }

                function saveSession() {
                    try { localStorage.setItem('solite-text-toolkit', JSON.stringify({ inputText: inputText.value })); }
                    catch (e) { console.error("Could not save session:", e); }
                }

                function showToast(message = 'Copied!', type = 'success') {
                    toast.textContent = message;
                    if(type === 'error') {
                        toast.classList.add('bg-red-500', 'text-white');
                        toast.classList.remove('bg-white', 'text-black');
                    } else {
                        toast.classList.remove('bg-red-500', 'text-white');
                        toast.classList.add('bg-white', 'text-black');
                    }
                    toast.classList.add('show');
                    setTimeout(() => {
                        toast.classList.remove('show');
                        // Reset to default message after it hides
                        if (message !== 'Copied!') setTimeout(() => { toast.textContent = 'Copied!'; }, 300);
                    }, 1500);
                }

                function loadSession() {
                    try {
                        const session = JSON.parse(localStorage.getItem('solite-text-toolkit'));
                        if (session && session.inputText) { 
                            inputText.value = session.inputText;
                            pushToHistory(session.inputText, true);
                        } else {
                            pushToHistory('', true);
                        }
                    } catch (e) { 
                        console.error("Could not load session:", e); 
                        pushToHistory('', true);
                    }
                }

                const debouncedUpdate = debounce((event) => {
                    if (event) pushToHistory(event.target.value);
                    updateOutput();
                });
                
                inputText.addEventListener('input', debouncedUpdate);

                transformSelect.addEventListener('change', () => {
                    pushToHistory(inputText.value);
                    updateOutput();
                })
                
                clearBtn.addEventListener('click', () => { pushToHistory(inputText.value); inputText.value = ''; updateOutput(); });
                
                swapBtn.addEventListener('click', () => { pushToHistory(inputText.value); inputText.value = outputText.value; updateOutput(); });

                copyBtn.addEventListener('click', () => {
                    if (outputText.value) {
                        // Use document.execCommand('copy') for better iframe compatibility
                        const tempTextarea = document.createElement('textarea');
                        tempTextarea.value = outputText.value;
                        document.body.appendChild(tempTextarea);
                        tempTextarea.select();
                        try {
                            document.execCommand('copy');
                            showToast('Copied!');
                        } catch (err) {
                            console.error('Failed to copy: ', err);
                            showToast('Failed to copy', 'error');
                        }
                        document.body.removeChild(tempTextarea);
                    }
                });

                replaceAllBtn.addEventListener('click', () => {
                    pushToHistory(inputText.value);
                    const find = findInput.value;
                    if (!find) return;
                    try {
                        const flags = caseSensitive.checked ? 'g' : 'gi';
                        const search = useRegex.checked ? new RegExp(find, flags) : new RegExp(find.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), flags);
                        inputText.value = inputText.value.replace(search, replaceInput.value || '');
                        updateOutput();
                    } catch (e) { 
                        console.error("Regex error:", e);
                        showToast('Invalid Regular Expression!', 'error'); 
                    }
                });

                inputText.addEventListener('paste', (e) => {
                    // Use setTimeout to allow paste to complete
                    setTimeout(() => {
                        pushToHistory(inputText.value);
                        const pastedText = (e.clipboardData || window.clipboardData).getData('text').trim();
                        if ((pastedText.startsWith('{') && pastedText.endsWith('}')) || (pastedText.startsWith('[') && pastedText.endsWith(']'))) {
                            try {
                                JSON.parse(pastedText); // Check if it's valid JSON
                                transformSelect.value = 'formatJson';
                                updateOutput();
                            } catch (error) { /* Not JSON */ }
                        }
                    }, 1);
                });

                undoBtn.addEventListener('click', () => {
                    if (textHistory.length > 1) {
                        const currentState = textHistory.pop();
                        redoHistory.push(currentState);
                        inputText.value = textHistory[textHistory.length - 1] || '';
                        updateOutput();
                    }
                    undoBtn.disabled = textHistory.length <= 1;
                    redoBtn.disabled = redoHistory.length === 0;
                });

                redoBtn.addEventListener('click', () => {
                    if (redoHistory.length > 0) {
                        const nextState = redoHistory.pop();
                        pushToHistory(nextState, false);
                        inputText.value = nextState;
                        updateOutput();
                    }
                    redoBtn.disabled = redoHistory.length === 0;
                });

                // --- ADDED: Mobile Navigation Logic ---
                function handleMobileLayout() {
                    if (window.innerWidth < 1024) {
                        // Check if any button is active, if not, default to 'Text'
                        const isActive = allBtns.some(btn => btn.classList.contains('active'));
                        if (!isActive) {
                            allPanes.forEach(pane => pane.classList.add('hidden'));
                            textPane.classList.remove('hidden');
                            mobileTextBtn.classList.add('active');
                        }
                    } else {
                        // Desktop: show all panes
                        allPanes.forEach(pane => pane.classList.remove('hidden'));
                        allBtns.forEach(btn => btn.classList.remove('active'));
                    }
                }

                function showPane(paneToShow, btnToActivate) {
                    allPanes.forEach(pane => pane.classList.add('hidden'));
                    allBtns.forEach(btn => btn.classList.remove('active'));
                    
                    paneToShow.classList.remove('hidden');
                    btnToActivate.classList.add('active');
                }

                mobileTextBtn.addEventListener('click', () => showPane(textPane, mobileTextBtn));
                mobileToolsBtn.addEventListener('click', () => showPane(toolsPane, mobileToolsBtn));
                mobileAnalysisBtn.addEventListener('click', () => showPane(analysisPane, mobileAnalysisBtn));

                window.addEventListener('resize', handleMobileLayout);
                // --- End Mobile Nav Logic ---

                loadSession();
                updateOutput();
                handleMobileLayout(); // Initial check on load
            }

            if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', init); }
            else { init(); }
        })();
    </script>
</body>
</html>



